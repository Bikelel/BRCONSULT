<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <data>
        <record id="view_prestation_prestation_list" model="ir.ui.view">
            <field name="name">prestation.prestation.list</field>
            <field name="model">prestation.prestation</field>
            <field name="arch" type="xml">
                <tree>
                    <field name="name" decoration-bf="1"/>
                    <field name="user_id" widget="many2one_avatar_user" optional="show"/>
                    <field name="create_date" string="Date de creation" widget="date" optional="hide"/>
                    <field name="date" string="Date de creation" widget="date" optional="show"/>
                    <field name="inspection_type" decoration-success="inspection_type == 'echafaudage'" decoration-info="inspection_type == 'levage'" widget="badge" optional="show"/>
                    <field name="installation_type"/>
                    <field name="verification_type"/>
                    <field name="partner_id"/>
                    <field name="company_id" invisible="1"/>
                </tree>
            </field>
        </record>
        <record id="view_prestation_search_form" model="ir.ui.view">
            <field name="name">prestation.prestation.search.form</field>
            <field name="model">prestation.prestation</field>
            <field name="arch" type="xml">
               <search string="Prestation">
                    <field name="name" string="Prestation"/>
                    <field name="partner_id"/>
                    <field name="user_id"/>
                    <field name="stage_id"/>
                    <filter string="Mes prestation" name="my_prestations" domain="[('user_id', '=', uid)]"/>
                    <filter string="Prestation en retard" name="late" domain="[('verification_date', '&lt;', context_today().strftime('%Y-%m-%d'))]"/>
                    <separator/>
                    <filter string="Echafaudage" name="echafaudage" domain="[('inspection_type', '=', 'echafaudage')]"/>
                    <separator/>
                    <filter string="Levage" name="levage" domain="[('inspection_type', '=', 'levage')]"/>
                    <group expand="0" string="Group By">
                        <filter string="Phases" name="stage" context="{'group_by': 'stage_id'}"/>
                        <filter string="Inspecteur" name="user" context="{'group_by': 'user_id'}"/>
                        <filter string="Entreprise" name="customer" context="{'group_by': 'partner_id'}"/>
                        <filter string="Date de vérification" name="group_verification_date" context="{'group_by': 'verification_date'}"/>
                    </group>
                </search>
            </field>
        </record>
        <record id="view_prestation_prestation_kanban" model="ir.ui.view">
            <field name="name">prestation.prestation.kanban</field>
            <field name="model">prestation.prestation</field>
            <field name="priority" eval="100"/>
            <field name="arch" type="xml">
                <kanban default_group_by="stage_id" class="oe_background_grey o_kanban_dashboard">
                    <field name="name"/>
                    <field name="partner_id"/>
                    <field name="inspection_type"/>
                    <field name="user_id"/>
                    <field name="kanban_color" invisible="1" force_save="1"/>
                    <templates>
                        <t t-name="kanban-box">
                            <div t-attf-class="oe_kanban_content oe_kanban_global_click  oe_kanban_card #{kanban_color(record.kanban_color.raw_value)}">
                                <div><strong class="o_kanban_record_title"><span> Date de vérification : <field name="verification_date"/></span></strong></div> 
                                <div><strong class="o_kanban_record_title"><span> Numéro de rapport : <field name="name"/></span></strong></div>
                                <div><span class="o_kanban_record_subtitle"> <strong> Entreprise : </strong> <field name="partner_id"/></span></div>
                                <div>
                                    <span class="o_kanban_record_subtitle"> <strong> Type de prestation : </strong><field     name="inspection_type"/></span>
                                     <span class="o_kanban_record_subtitle"> <strong> Adresse du chantier : </strong><field name="site_address"/></span>
                                </div>
                                <div class="o_kanban_record_bottom">
                                    <div class="oe_kanban_bottom_right">
                                        <field name="user_id" widget="many2one_avatar_user"/>
                                    </div>
                                </div>
                            </div>
                        </t>
                    </templates>
                </kanban>
            </field>
        </record>
        <record model="ir.ui.view" id="view_prestation_graph">
            <field name="name">prestation.prestation.graph</field>
            <field name="model">prestation.prestation</field>
            <field name="arch" type="xml">
                <graph string="Prestation" sample="1">
                    <field name="user_id"/>
                    <field name="inspection_type"/>
                </graph>
            </field>
        </record>
        <record id="quick_calendar_form_view_prestation" model="ir.ui.view">
            <field name="name">prestation.prestation.form</field>
            <field name="model">prestation.prestation</field>
            <field name="priority" eval="100"/>
            <field name="arch" type="xml">
                <form string="Prestation">
                    <sheet>
                        <group>
                            <field name="name"/>
                            <field name="state"/>
                            <field name="user_id"/>
                        </group>
                    </sheet>
                </form>
            </field>
        </record>
        <record id="view_prestation_calendar" model="ir.ui.view">
            <field name="name">prestation.prestation.calendar</field>
            <field name="model">prestation.prestation</field>
            <field eval="2" name="priority"/>
            <field name="arch" type="xml">
                <calendar date_start="verification_date" string="Prestation" mode="week" color="user_id" date_delay="prestation_duration" form_view_id="%(br_consult.quick_calendar_form_view_prestation)d">
                    
                    <field name="inspection_type" filters="1"/>
                    <field name="site_address"/>
                    <field name="installation_type"/>
                    <field name="verification_type"/>
                    <field name="user_id" filters="1"/>
                    <field name="partner_id"/>
                    <field name="verification_date"/>
                    <field name="stage_id"/>
                </calendar>
            </field>
        </record>
        

        
        <record id="view_prestation_prestation_form" model="ir.ui.view">
            <field name="name">prestation.prestation.form</field>
            <field name="model">prestation.prestation</field>
            <field name="priority" eval="10"/>
            <field name="arch" type="xml">
                <form string="Prestation">
                    <header>
                        <field name="state" widget="statusbar" statusbar_visible="phase1,phase2,phase3,phase4" force_save="1"/>
                        <button name="button_send_confirmation_prestation" string="Envoyer la confirmation de planning au client" type="object" attrs="{'invisible': [('state_confirmation_sent', '!=', 'draft')]}" class="btn-primary" />
                        
                        <button name="button_phase2" string="Envoyer vers Phase 2" type="object" attrs="{'invisible': [('state', '!=', 'phase1')]}" class="btn-primary" />
                       <button name="button_phase3" string="Envoyer vers Phase 3" type="object" attrs="{'invisible': [('state', '!=', 'phase2')]}" class="btn-primary" />
                        <button name="button_phase4" string="Envoyer vers Phase 4" type="object" attrs="{'invisible': [('state', '!=', 'phase3')]}" class="btn-primary"/>
                        <button name="button_send_report" string="Envoyer le rapport" type="object" attrs="{'invisible': ['|',('state', '!=', 'phase4'), ('is_report_sent', '=', True)]}" class="btn-primary"/>
                        <button name="button_send_report" string="Envoyer le rapport" type="object" attrs="{'invisible': [('is_report_sent', '=', False)]}" groups="base.group_system"/>
                    </header>
                    <sheet>
                        <div class="prestation_sheet_header">
                            <div class="prestation_sheet_header_fiche">Fiche d'intervention</div>
                            <div class="prestation_name" attrs="{'invisible': [('title_label', '=', '')]}">
                                <field name="title_label" readonly="1" force_save="1"/>
                            </div>
                            <div class="prestation_sheet_header_reference" attrs="{'invisible': [('message_label', '=', '')]}">
                                <field name="message_label" readonly="1" force_save="1"/>
                            </div>
                        </div>
                        <group>
                            <group>
                                <field name="inspection_type" required="1" attrs="{'readonly': [('state', '!=', 'phase1')]}"/>
                                <field name="report_parameter_id" invisible="1" />
                                <field name="is_report_sent" invisible="1" />
                                <field name="state_confirmation_sent" invisible="1"/>
                            </group>
                            <group>
                                <field name="installation_type" attrs="{'invisible': [('inspection_type', '!=', 'levage')], 'required': [('inspection_type', '=', 'levage')], 'readonly': [('state', '!=', 'phase1')]}" />
                                <field name="verification_type" required='1' attrs="{'readonly': [('state', '!=', 'phase1')]}"/>
                            </group>
                        </group>
                        <notebook>
                            <page name='fiche' string="Fiche" attrs="{'invisible': [('verification_type', 'not in', ['MS', 'RS', 'VP'])]}">
                                <group>
                                    <group>
                                        <field name="name" readonly="1" force_save="1"/>
                                        <field name="company_id" invisible="1"/>
                                        <field name="requested_date" attrs="{'readonly': [('state', 'not in', ['phase1'])]}"/>
                                        <field name="partner_id" required="1" domain="[('is_company', '=', True)]" options="{'no_create': True}" attrs="{'readonly': [('state', 'not in', ['phase1'])]}"/>
                                        <field name="partner_contact" attrs="{'readonly': [('state', 'not in', ['phase1'])]}"/>
                                        <field name="email_partner_ids" attrs="{'readonly': [('state', 'not in', ['phase1', 'phase2', 'phase3'])]}" widget="many2many_tags_email" domain="[('parent_id', '=', partner_id)]"/>
                                        <field name="site_address" required="1" attrs="{'readonly': [('state', 'not in', ['phase1', 'phase3'])]}"/>
                                        <field name="zip"/>
                                        <field name="department_id"/>
                                        
                                        
                                        <field name="country_id"/>
                                        
                                        <field name="site_localisation" attrs="{'readonly': [('state', 'not in', ['phase1', 'phase2'])]}"/>
                                    </group>
                                    <group>
                                        <field name="date" attrs="{'readonly': [('state', 'not in', ['phase1', 'phase2'])]}"/>
                                        <field name="verification_date" attrs="{'readonly': [('state', 'not in', ['phase1', 'phase3'])]}"/>
                                        <field name="end_date_verification" invisible="1"/>
                                        <field name="user_id" domain="[('is_inspector', '=', True)]" attrs="{'readonly': [('state', 'not in', ['phase1'])]}"/>
                                        <field name="prensent_contact" attrs="{'readonly': [('state', 'not in', ['phase3', 'phase2'])]}"/>
                                        <field name="scaffolding_surface" attrs="{'invisible': [('inspection_type', '!=', 'echafaudage')], 'readonly': [('state', 'not in', ['phase1'])]}"/>
                                        <field name="inspected_scaffolding_surface" attrs="{'invisible': [('inspection_type', '!=', 'echafaudage')]}" widget="integer"/>
                                        <field name="announced_installation_number" attrs="{'invisible': [('inspection_type', '!=', 'levage')], 'readonly': [('state', 'not in', ['phase1'])]}"/>
                                        <field name="inspected_installation_number" attrs="{'invisible': [('inspection_type', '!=', 'levage')]}"/>
                                    </group>
                                </group>
                                <group string="Conformité de l’installation">
<!--                                     <group> -->
                                        <field name="opinion" attrs="{'readonly': [('state', 'not in', ['phase2', 'phase3'])], 'required': [('state', 'in', ['phase2', 'phase3'])]}"/>
                                        
<!--                                         <field name="favorable_opinion" attrs="{'readonly': [('state', 'not in', ['phase2', 'phase3'])]}"/>
                                        <field name="opinion_with_observation" attrs="{'readonly': [('state', 'not in', [ 'phase2', 'phase3'])]}"/> -->
<!--                                     </group> -->
<!--                                     <group> -->
<!--                                         <field name="defavorable_opinion" attrs="{'readonly': [('state', 'not in', [ 'phase2', 'phase3'])]}"/> -->
                                        
<!--                                     </group> -->
                                </group>
                                <group string="Commentaires">
                                    <field name="comment_observation_fiche" nolabel="1" attrs="{'readonly': [('state', 'not in', ['phase2', 'phase3'])]}"/>
                                </group>
                                <group string="Visa de l’inspecteur technique">
                                    <group>
                                        <field name='visa_user' widget='image' options='{"size":[0,180]}'/>
                                    </group>
                                </group>
                            </page>
                            <page name='scope_mission' string="Périmètre de la mission" attrs="{'invisible': [('verification_type', 'not in', ['MS', 'RS', 'VP'])]}">
                                <group>
                                    <field name="motif_rs_id" attrs="{'invisible': [('verification_type', 'not in', ['RS'])], 'readonly': [('state', 'not in', ['phase1','phase2', 'phase3'])]}" domain="[('inspection_type', '=', inspection_type)]"/>
                                    
                                    <field name="contrat_ref" string="La mission est réalisée conformément au contrat réf" attrs="{'readonly': [('state', 'not in', ['phase1','phase2', 'phase3'])]}"/>
                                    <field name="prestation_id" attrs="{'invisible': [('verification_type', 'not in', ['RS', 'VP'])], 'readonly': [('state', 'not in', ['phase1','phase2', 'phase3'])]}" domain="[('inspection_type', '=', inspection_type), ('installation_type', '=', installation_type), ('is_report_sent', '=', True)]" options="{'no_create': True}"/>
                                    <field name="autre_prestation" attrs="{'invisible': ['|', ('prestation_id', '!=', False), ('verification_type', 'not in', ['RS', 'VP'])], 'readonly': [('state', 'not in', ['phase1','phase2', 'phase3'])]}" placeholder="Si le repport n'existe pas dans la base, mentionner manullement une réf ici!!"/>
                                    
                                    
                                    <field name="scope_mission_date" attrs="{'invisible':[('verification_type', 'not in', ['RS', 'VP'])], 'readonly': [('state', 'not in', ['phase1','phase2', 'phase3'])]}"/>
                                </group>
                                <group string="Commentaires">
                                    <field name="comment_scope_mission" nolabel="1" attrs="{'readonly': [('state', 'not in', ['phase1','phase2', 'phase3'])]}"/>
                                </group>
                            </page>
                            <page name='scaffolding_photographic_location' string="Localisation photographique" attrs="{'invisible': [('verification_type', 'not in', ['MS', 'RS', 'VP'])]}">
                                <group string="Schéma de l’emplacement">
                                    <field name="location_diagram" nolabel="1" options='{"size":[0,90]}' widget='image' attrs="{'readonly': [('state', 'not in', ['phase2', 'phase3'])]}"/>
                                </group>
                                <group string="Photographies">

                                    <group>
                                        <field name="image1" nolabel="1" options='{"size":[0,90]}' widget='image' attrs="{'readonly': [('state', 'not in', ['phase2', 'phase3'])]}"/>
                                    </group>
                                    <group>
                                        <field name="image2" nolabel="1" options='{"size":[0,90]}' widget='image' attrs="{'readonly': [('state', 'not in', ['phase2', 'phase3'])]}"/>
                                    </group>
                                    <group>
                                        <field name="image3" nolabel="1" options='{"size":[0,90]}' widget='image' attrs="{'readonly': [('state', 'not in', ['phase2', 'phase3'])]}"/>
                                    </group>
                                    <group>
                                        <field name="image4" nolabel="1" options='{"size":[0,90]}' widget='image' attrs="{'readonly': [('state', 'not in', ['phase2', 'phase3'])]}"/>
                                    </group>
                                    <group>
                                        <field name="image5" nolabel="1" options='{"size":[0,90]}' widget='image' attrs="{'readonly': [('state', 'not in', ['phase2', 'phase3'])]}"/>
                                    </group>
                                    <group>
                                        <field name="image6" nolabel="1" options='{"size":[0,90]}' widget='image' attrs="{'readonly': [('state', 'not in', ['phase2', 'phase3'])]}"/>
                                    </group>
                                </group>
                                <group string="Commentaires">
                                    <field name="comment_scaffolding_photographic_location" nolabel="1" attrs="{'readonly': [('state', 'not in', ['phase2', 'phase3'])]}"/>
                                </group>
                            </page>
                            <page name='scaffolding_characteristic' string="Caractéristiques de l'échafaudage" attrs="{'invisible': ['|',('verification_type', 'not in', ['MS', 'RS', 'VP']), ('inspection_type', '!=', 'echafaudage')]}">
                                <group string="Description générale">
                                    <field name="scaffolding_mark_ids" nolabel="1" attrs="{'readonly': [('state', 'not in', ['phase2', 'phase3'])]}">
                                        <tree editable='bottom'>
                                            <field name="mark_id"/>
                                            <field name="type"/>
                                            <field name="height"/>
                                            <field name="height_max"/>
                                            <field name="linear"/>
                                            <field name="inspected_surface" sum="Total"/>
                                        </tree>
                                    </field>
                                </group>
                                <group string="Spécificité de l’échafaudage" />
                                    <field name="scaffolding_characteristic_ids" nolabel="1" attrs="{'readonly': [('state', 'not in', ['phase2', 'phase3'])]}" force_save="1">
                                        <tree editable='bottom'>
                                            <field name="characteristic_id"/>
                                            <field name="is_presence"/>
                                            <field name="length" attrs="{'readonly': ['|',('is_length', '=', False), ('is_presence', '=', 'no')]}" force_save="1"/>
                                            <field name="width" attrs="{'readonly': ['|',('is_width', '=', False),('is_presence', '=', 'no')]}" force_save="1"/>
                                            <field name="height" attrs="{'readonly': ['|',('is_height', '=', False),('is_presence', '=', 'no')]}" force_save="1"/>
                                            <field name="surface" attrs="{'readonly': ['|', ('is_surface', '=', False), ('is_presence', '=', 'no')]}" force_save="1"/>
                                            <field name="localisation_id"/>
                                            <field name="is_length" invisible="1"/>
                                            <field name="is_width" invisible="1"/>
                                            <field name="is_height" invisible="1"/>
                                            <field name="is_surface" invisible="1"/>
                                        </tree>
                                    </field>
                                <group string="Commentaires">
                                    <field name="comment_scaffolding_characteristic" nolabel="1" attrs="{'readonly': [('state', 'not in', ['phase2', 'phase3'])]}"/>
                                </group>
                            </page>
                            <page name='characteristic_suspended_platform' string="Caractéristiques de levage" attrs="{'invisible': ['|',('verification_type', 'not in', ['MS', 'RS', 'VP']), ('inspection_type', '!=', 'levage')]}">
                                <group attrs="{'invisible': [('installation_type', 'not in', ['PSM', 'PSE'])]}">
                                    <field name="characteristic_suspended_platform_ids" nolabel="1" context="{'default_prestation_id':active_id}" attrs="{'readonly': [('state', 'not in', ['phase2', 'phase3'])]}" force_save="1">
                                        <tree>
                                            <field name="name"/>
                                        </tree>
                                    </field>
                                </group>
                                <group attrs="{'invisible': [('installation_type', 'not in', ['PWM', 'ASC', 'PTR', 'MMA'])]}">
                                    <field name="characteristic_platform_ids" nolabel="1" context="{'default_prestation_id':active_id}" attrs="{'readonly': [('state', 'not in', ['phase2', 'phase3'])]}" force_save="1">
                                        <tree>
                                            <field name="name"/>
                                        </tree>
                                    </field>
                                </group>
                                <group attrs="{'invisible': [('installation_type', 'not in', ['TRE', 'PAE', 'PAM'])]}">
                                    <field name="characteristic_palan_ids" nolabel="1" context="{'default_prestation_id':active_id}" attrs="{'readonly': [('state', 'not in', ['phase2', 'phase3'])]}" force_save="1">
                                        <tree>
                                            <field name="name"/>
                                        </tree>
                                    </field>
                                </group>
                                
                                <group string="Commentaires">
                                    <field name="comment_levage_characteristic" nolabel="1" attrs="{'readonly': [('state', 'not in', ['phase2', 'phase3'])]}"/>
                                </group>
                            </page>
                            
                            <page name='exams' string="Examens" attrs="{'invisible': [('verification_type', 'not in', ['MS', 'RS', 'VP'])]}">
                                <h1 class="headding_1">4.1- Examen d'adéquation</h1>
                                <group>
                                    
                                    <field name="adequacy_exam_ids" nolabel="1" attrs="{'readonly': [('state', 'not in', ['phase1','phase2', 'phase3'])]}">
                                        <tree editable='bottom'>
                                            <field name="works_nature_id"/>
                                            <field name="precision"/>
                                            <field name="is_examined"/>
                                        </tree>
                                    </field>
                                </group>
                                <group string="Dispositif de protection" >
                                    <field name="is_pare_gravats" attrs="{'invisible':[('inspection_type', '!=', 'echafaudage')], 'readonly': [('state', 'not in', ['phase2', 'phase3'])]}"/>
                                    <field name="is_other_device" attrs="{'invisible':[('inspection_type', '!=', 'echafaudage')], 'readonly': [('state', 'not in', ['phase2', 'phase3'])]}"/>
                                    <field name="other_device_id" attrs="{'invisible':[('is_other_device', '!=', 'yes')], 'readonly': [('state', 'not in', ['phase2', 'phase3'])]}" domain="[('inspection_type', '=', inspection_type)]"/>
                                    <field name="protection_dispositif" attrs="{'invisible':[('inspection_type', '!=', 'levage')], 'readonly': [('state', 'not in', ['phase2', 'phase3'])]}"/>
                                    <field name="levage_protection_dispositif" attrs="{'invisible':[('protection_dispositif', '!=', 'yes')], 'readonly': [('state', 'not in', ['phase2', 'phase3'])]}" string="Dispositif de protection" domain="[('inspection_type', '=', inspection_type)]" context = "{'default_inspection_type':inspection_type}"/>
                                </group>
                                <group attrs="{'invisible': [('installation_type', 'not in', [ 'ASC', 'PTR', 'MMA', 'TRE', 'PAE', 'PAM'])]}">
                                    <field name="installation_use_id" domain="[('installation_type', '=', installation_type)]" context = "{'default_installation_type':installation_type}" attrs="{'readonly': [('state', 'not in', ['phase2', 'phase3'])]}"/>
                                    
                                </group>
                                <group string="Charge d'exploitation de l'échafaudage par défaut" attrs="{'invisible':[('inspection_type', '!=', 'echafaudage')]}">
                                    <field name="scaffolding_operating_load_ids" nolabel="1" attrs="{'readonly': [('state', 'not in', ['phase2', 'phase3'])]}">
                                        <tree editable='bottom'>
                                            <field name="scaffolding_class_id" options="{'no_create': True}"/>
                                            <field name="operating_overload"/>
                                            <field name="precision"/>
                                            
                                        </tree>
                                    </field>
                                </group>
                                <group string="Constat (s)" attrs="{'invisible': [('inspection_type', '=', 'levage'), ('verification_type', '=', 'VP')]}">
                                    <field name="constat_adequacy_exam_ids" nolabel="1" context="{'default_prestation_id':active_id, 'default_type': 'adequacy_exam'}" attrs="{'readonly': [('state', 'not in', ['phase2', 'phase3'])]}">
                                        <tree>
                                            <field name="verification_point_id" />
                                            <field name="constat_observation_ids" widget="many2many_tags" options="{'color_field': 'color'}"/>
                                            <field name="inspection_type" invisible="1"/>
                                            <field name="installation_type" invisible="1"/>
                                            <field name="precision"/>
                                            <field name="photo" options='{"size":[0,90]}' widget='image'/>
                                            <field name="state" invisible="1"/>
                                            <field name="date" invisible="1"/>
                                            <button name="action_show_details" string="Edit" type="object" />

                                        </tree>
                                    </field>
                                </group>
                                <h1 class="headding_1" attrs="{'invisible': [('inspection_type', '!=', 'echafaudage')]}">4.2- Examen de montage et d'exploitation</h1>
                                <h1 class="headding_1" attrs="{'invisible': [('inspection_type', '!=', 'levage')]}">4.2- Examen de montage et d'installation</h1>
                                <group>
                                    <field name="security_register" attrs="{'readonly': [('state', 'not in', ['phase2', 'phase3'])]}"/>
                                </group>
                                <group string="Présentation du dossier du montage">
                                    <field name="assembly_file" attrs="{'readonly': [('state', 'not in', ['phase2', 'phase3'])]}"/>
                                    
                                    <field name="notice_constructeur" attrs="{'readonly': [('state', 'not in', ['phase2', 'phase3'])]}"/>
                                    <field name="execution_plan" attrs="{'invisible': [('assembly_file', '!=', 'yes')], 'readonly': [('state', 'not in', ['phase2', 'phase3'])]}"/>
                                    <field name="calculation_notice" attrs="{'invisible': [('assembly_file', '!=', 'yes')], 'readonly': [('state', 'not in', ['phase2', 'phase3'])]}"/>
                                    
                                    <field name="maintenance_log" attrs="{'readonly': [('state', 'not in', ['phase2', 'phase3'])]}"/>
                                    
                                    
                                    <field name="manufacturer_instructions" invisible="1"/>
                                    
                                </group>
                                <group string="Données relatives au sol ou au support d'implantation">
                                
                                    <field name="soil_support_data_ids" string="Choix" widget="many2many_tags" attrs="{'readonly': [('state', 'not in', ['phase2', 'phase3'])]}"/>
                                </group>
                                <group string="Données relatives à la nature d’ancrage">
                                    <field name="anchor_support_data_ids" string="Choix" widget="many2many_tags" attrs="{'readonly': [('state', 'not in', ['phase2', 'phase3'])]}"/>
                                    
                                </group>
                                <group string="Données aux ancrages" attrs="{'invisible': [('inspection_type', '!=', 'echafaudage')]}">
                                    <field name="anchor_type_id" attrs="{'readonly': [('state', 'not in', ['phase2', 'phase3'])]}"/>
                                    <field name="ankles_type" attrs="{'invisible':[('anchor_type_id', '!=', 1)]}"/>
                                    <field name="anchor_data_number" widget='integer' attrs="{'readonly': [('state', 'not in', ['phase2', 'phase3'])]}"/>
                                    <field name="anchor_data_theoretical_number" widget='integer' attrs="{'readonly': [('state', 'not in', ['phase2', 'phase3'])]}"/>
                                    <field name="anchor_data_difference_number" widget='integer' attrs="{'readonly': [('state', 'not in', ['phase2', 'phase3'])]}"/>
                                </group>
                                <group string="Données relatives aux réactions d'appuis au sol ou au support d’accueil" attrs="{'invisible': [('inspection_type', '!=', 'echafaudage')]}">
                                    <field name="ground_support_data" string="Choix" attrs="{'readonly': [('state', 'not in', ['phase2', 'phase3'])]}"/>
                                </group>
                                <group string="Données relatives aux charges climatiques" attrs="{'invisible': [('inspection_type', '!=', 'echafaudage')]}">
                                    <field name="climatic_data" string="Valeur" attrs="{'readonly': [('state', 'not in', ['phase2', 'phase3'])]}"/>
                                </group>
                                <group string="Données relatives à la nature du bâchage éventuel" attrs="{'invisible': [('inspection_type', '!=', 'echafaudage')]}">
                                    <field name="covering_nature_data" string="Choix" attrs="{'readonly': [('state', 'not in', ['phase2', 'phase3'])]}"/>
                                </group>
                                <group string="Commentaire" attrs="{'invisible': [('inspection_type', '!=', 'levage')]}">
                                    <field name="comment_assembly_exam" string="Commentaires" attrs="{'readonly': [('state', 'not in', ['phase2', 'phase3'])]}" force_save="1"/>
                                </group>
                                <group string="Constat (s)" attrs="{'invisible': [('inspection_type', '=', 'levage'), ('verification_type', '=', 'VP')]}">
                                    <field name="constat_assembly_exam_ids" nolabel="1" attrs="{'readonly': [('state', 'not in', ['phase2', 'phase3'])]}" context="{'default_prestation_id':active_id, 'default_type': 'assembly_exam'}">
                                        <tree>
                                            <field name="verification_point_id" options="{'no_create': True}"/>
                                            <field name="constat_observation_ids" widget="many2many_tags" options="{'color_field': 'color'}"/>
                                            <field name="precision"/>
                                            <field name="photo" options='{"size":[0,90]}' widget='image'/>
                                            <field name="state" invisible="1"/>
                                            <field name="date" invisible="1"/>
                                            <field name='inspection_type' invisible="1"/>
                                            <field name="installation_type" invisible="1"/>
                                            <button name="action_show_details" string="Edit" type="object" />

                                        </tree>
                                    </field>
                                </group>
                                <h1 class="headding_1">4.3- Examen de l'etat de conservation</h1>
                                <group>
                                    <field name="conservation_state_exam_ids" nolabel="1" attrs="{'readonly': [('state', 'in', ['phase1'])]}">
                                        <tree editable="bottom" delete="false" create="false">
                                            <field name="conservation_state_id" invisible="1"/>
                                            <field name="name" readonly="1" widget="html"/>
                                            <field name="opinion"/>
                                            
                                        </tree>
                                    </field>
                                </group>

                                <group string="Constat (s)">
                                    <field name="constat_conservation_state_exam_ids" nolabel="1" attrs="{'readonly': [('state', 'not in', ['phase2', 'phase3'])]}" context="{'default_prestation_id':active_id, 'default_type': 'conservation_state_exam'}">
                                        <tree>
                                            <field name="verification_point_id" options="{'no_create': True}" />
                                            <field name="constat_observation_ids" widget="many2many_tags"  options="{'color_field': 'color'}"/>
                                            <field name="precision"/>
                                            <field name="photo" options='{"size":[0,90]}' widget='image'/>
                                            <field name="state" invisible="1"/>
                                            <field name="date" invisible="1"/>
                                            <field name="inspection_type" invisible="1"/>
                                            <field name="installation_type" invisible="1"/>
                                            <button name="action_show_details" string="Edit" type="object" />
                                        </tree>
                                    </field>
                                </group>
                                <h1 class="headding_1" attrs="{'invisible': [('inspection_type', '!=', 'levage')]}">4.4- Examen du bon fonctionnement</h1>
                                <group attrs="{'invisible': [('inspection_type', '!=', 'levage')]}">
                                    <field name="good_functioning_exam_ids" nolabel="1" attrs="{'readonly': [('state', 'in', ['phase1'])]}">
                                        <tree editable="bottom" delete="false" create="false">
                                            <field name="good_functioning_id" invisible="1"/>
                                            <field name="name" readonly="1" widget='html'/>
                                            <field name="opinion"/>
                                            
                                        </tree>
                                    </field>
                                </group>

                                <group string="Constat (s)" attrs="{'invisible': [('inspection_type', '!=', 'levage')]}">
                                    <field name="constat_good_functioning_exam_ids" nolabel="1" attrs="{'readonly': [('state', 'not in', ['phase2', 'phase3'])]}" context="{'default_prestation_id':active_id, 'default_type': 'good_functioning'}">
                                        <tree>
                                            <field name="verification_point_id" options="{'no_create': True}"/>
                                            <field name="constat_observation_ids" widget="many2many_tags"  options="{'color_field': 'color'}"/>
                                            <field name="precision"/>
                                            <field name="photo" options='{"size":[0,90]}' widget='image'/>
                                            <field name="state" invisible="1"/>
                                            <field name="date" invisible="1"/>
                                            <field name="installation_type" invisible="1"/>
                                            <button name="action_show_details" string="Edit" type="object" />
                                        </tree>
                                    </field>
                                </group>
                                
                            </page>
                            <page name='epreuve' string="Epreuves" attrs="{'invisible': ['|',('verification_type', 'not in', ['MS', 'RS', 'VP']), ('inspection_type', '!=', 'levage')]}">
                                
                                <h1 class="headding_1">5.1- Epreuve statique</h1>
                                <group>
                                    <field name="coefficient_statique" string="Coefficient" attrs="{'readonly': [('state', 'not in', ['phase2', 'phase3'])]}" force_save="1"/>
                                    <field name="autorised_cmu_statique" string="CMU Autorisée" attrs="{'readonly': [('state', 'not in', ['phase2', 'phase3'])]}"/>
                                    <field name="theoretical_test_load_statique" string="Charge d'épreuve théorique (en KG)" attrs="{'readonly': [('state', 'not in', ['phase2', 'phase3'])]}"/>
                                    <field name="reel_test_load_statique" attrs="{'invisible': [('verification_type', 'not in', ['MS', 'RS'])], 'readonly': [('state', 'not in', ['phase2', 'phase3'])]}" string="Charge d'épreuve réelle (en KG)"/>
                                    <field name="test_duration_statique" attrs="{'invisible': [('verification_type', 'not in', ['MS', 'RS'])], 'readonly': [('state', 'not in', ['phase2', 'phase3'])]}" widget="float_time" />
                                    <field name="elevation_height_statique" attrs="{'invisible': [('verification_type', 'not in', ['MS', 'RS'])], 'readonly': [('state', 'not in', ['phase2', 'phase3'])]}" />
                                    <field name="comment_epreuve_statique" string="Commentaire" attrs="{'readonly': [('state', 'not in', ['phase2', 'phase3'])]}" force_save="1"/>
                                    
                                </group>
                                <group string="Constat (s)" attrs="{'invisible': [('verification_type', 'not in', ['MS', 'RS'])]}">
                                    <field name="constat_epreuve_statique_ids" nolabel="1" attrs="{'readonly': [('state', 'not in', ['phase2', 'phase3'])]}" context="{'default_prestation_id':active_id, 'default_type': 'epreuve_statique'}">
                                        <tree style="max-width:90%;">
                                            <field name="verification_point_id" options="{'no_create': True}" />
                                            <field name="constat_observation_ids"  widget="many2many_tags" options="{'color_field': 'color'}"/>
                                            <field name="precision"/>
                                            <field name="photo" options='{"size":[0,90]}' widget='image'/>
                                            <field name="state" invisible="1"/>
                                            <field name="date" invisible="1"/>
                                            <field name="installation_type" invisible="1"/>
                                            <button name="action_show_details" string="Edit" type="object" />
                                        </tree>
                                    </field>
                                </group>
                                <h1 class="headding_1">5.2- Epreuve dynamique</h1>
                                <group>
                                    <field name="coefficient_dynamique" string="Coefficient" attrs="{'readonly': [('state', 'not in', ['phase2', 'phase3'])]}" force_save="1"/>
                                    <field name="autorised_cmu_dynamique" string="CMU Autorisée" attrs="{'readonly': [('state', 'not in', ['phase2', 'phase3'])]}"/>
                                    <field name="theoretical_test_load_dynamique" string="Charge d'épreuve théorique (en KG)" attrs="{'readonly': [('state', 'not in', ['phase2', 'phase3'])]}"/>
                                    <field name="reel_test_load_dynamique" attrs="{'invisible': [('verification_type', 'not in', ['MS', 'RS'])], 'readonly': [('state', 'not in', ['phase2', 'phase3'])]}" string="Charge d'épreuve réelle (en KG)"/>
                                    
                                    <field name="comment_epreuve_dynamique" string="Commentaire" attrs="{'readonly': [('state', 'not in', ['phase2', 'phase3'])]}" force_save="1"/>
                                    
                                </group>
                                <group string="Constat (s)" attrs="{'invisible': [('verification_type', 'not in', ['MS', 'RS'])]}">
                                    <field name="constat_epreuve_dynamique_ids" nolabel="1" attrs="{'readonly': [('state', 'not in', ['phase2', 'phase3'])]}" context="{'default_prestation_id':active_id, 'default_type': 'epreuve_dynamique'}">
                                        <tree style="max-width:90%;">
                                            <field name="verification_point_id" options="{'no_create': True}" />
                                            <field name="constat_observation_ids"  widget="many2many_tags"  options="{'color_field': 'color'}"/>
                                            <field name="precision"/>
                                            <field name="photo" options='{"size":[0,90]}' widget='image'/>
                                            <field name="state" invisible="1"/>
                                            <field name="date" invisible="1"/>
                                            <field name="installation_type" invisible="1"/>
                                            <button name="action_show_details" string="Edit" type="object" />
                                        </tree>
                                    </field>
                                </group>
                            </page>
                            
                        </notebook>
                    </sheet>
                    <div class="oe_chatter">
                        <field name="message_follower_ids"/>
                        <field name="activity_ids"/>
                        <field name="message_ids"/>
                    </div>
                </form>
            </field>
        </record>
    
    <record id="action_prestation_prestation" model="ir.actions.act_window">
        <field name="name">Prestation</field>
        <field name="res_model">prestation.prestation</field>
        <field name="context">{}</field>
        <field name="domain">[('is_report_sent', '=', False)]</field>
        <field name="view_mode">kanban,tree,form,graph,calendar</field>
    </record>

    <menuitem name="Prestation" 
              id="prestation_consult_menu_prestation" 
              parent="br_consult_menu_root"
              action="action_prestation_prestation"/>
    
    <record id="action_prestation_prestation_planning" model="ir.actions.act_window">
        <field name="name">Prestation</field>
        <field name="res_model">prestation.prestation</field>
        <field name="context">{}</field>
        <field name="context">{'search_default_my_prestations': 1}</field>
        <field name="domain">[('is_report_sent', '=', False)]</field>
        <field name="view_mode">calendar</field>
    </record>
    
    <menuitem id="br_consult_planning_menu"
        name="Mon planning"
        parent="br_consult_menu_root"
        action="action_prestation_prestation_planning"
        sequence="30"/>
    
    <record id="action_prestation_prestation_planning_all_team" model="ir.actions.act_window">
        <field name="name">Prestation</field>
        <field name="res_model">prestation.prestation</field>
        <field name="context">{}</field>
        <field name="context">{}</field>
        <field name="domain">[('is_report_sent', '=', False)]</field>
        <field name="view_mode">calendar</field>
    </record>
    
    <menuitem id="br_consult_planning_all_team_menu"
        name="Planning des inspecteurs"
        parent="br_consult_menu_root"
        action="action_prestation_prestation_planning_all_team"
        groups="base.group_system"
        sequence="33"/>
    
    <record id="action_prestation_prestation_stat" model="ir.actions.act_window">
        <field name="name">Prestation</field>
        <field name="res_model">prestation.prestation</field>
        <field name="context">{}</field>
        <field name="domain">[]</field>
        <field name="view_mode">graph,tree</field>
    </record>
    
    <menuitem id="br_consult_stat_menu"
        name="Statistique"
        parent="br_consult_menu_root"
        action="action_prestation_prestation_stat"
        groups="base.group_system"
        sequence="35"/>
    
    <record id="action_prestation_prestation_archive" model="ir.actions.act_window">
        <field name="name">Prestations archivées</field>
        <field name="res_model">prestation.prestation</field>
        <field name="context">{}</field>
        <field name="domain">[('is_report_sent', '=', True)]</field>
        <field name="view_mode">tree,form</field>
    </record>
    
    <menuitem id="br_consult_archive_menu"
        name="Archive"
        parent="br_consult_menu_root"
        action="action_prestation_prestation_archive"
        sequence="40"/>

  </data>
</odoo>